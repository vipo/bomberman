extern crate num;

//use im::HashMap;
use std::collections::HashMap;

#[derive(Debug, Clone)]
#[repr(u8)]
#[derive(FromPrimitive, ToPrimitive)]
pub enum Cell {
    E = 0, // Empty
    S = 1, // Stone
    B = 8, // Brick
}

type Coord = (usize, usize);

#[derive(Debug)]
pub struct Game {
    landscape: HashMap<Coord, Cell>,
}

const LENGTH: usize = 15;
#[rustfmt::skip]
pub static CLASSIC: [u8; LENGTH * LENGTH] = [
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
];

pub fn new(template: &[u8; LENGTH * LENGTH]) -> Game {
    let mut m: HashMap<Coord, Cell> = HashMap::new();
    for h in 0..LENGTH {
        for w in 0..LENGTH {
            m.insert(
                (w, h),
                num::FromPrimitive::from_u8(template[h * LENGTH + w]).unwrap(),
            );
        }
    }
    return Game { landscape: m };
}
